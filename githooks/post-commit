#!/bin/sh

echo "Executing git/hooks/post-commit"

VERSION_FILE=version.go
CURRENT_VERSION=$(git describe --always --long --dirty)
CURRENT_VERSION_DATE=$(date)

function generateVersionFile () {
	rm -f $VERSION_FILE
	echo "// Code generated by git post-commit hook; DO NOT EDIT." >> $VERSION_FILE
	echo "package main" >> $VERSION_FILE
	echo "const version = \"$CURRENT_VERSION\"" >> $VERSION_FILE
	echo "const versionDate = \"$CURRENT_VERSION_DATE\"" >> $VERSION_FILE
}

echo
if [ -a .commit ]; then
    rm .commit
    generateVersionFile
    git add $VERSION_FILE
    git commit --amend -C HEAD --no-verify
fi

